
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Stork Community ID Badge Generator</title>
  <style>
    body { font-family: Arial, sans-serif; background: #0d0d0d; color: #fff; text-align: center; padding: 20px; }
    h1 { color: #A5F8FF; }
    form { max-width: 400px; margin: 0 auto 20px; text-align: left; }
    input, button { width: 100%; margin: 10px 0; padding: 10px; border-radius: 6px; border: none; }
    button { background: #001F3F; color: #A5F8FF; font-weight: bold; cursor: pointer; }
    #badgeContainer { perspective: 1000px; width: 320px; height: 400px; margin: 20px auto; position: relative; }
    .badge { width: 100%; height: 100%; position: absolute; transition: transform 0.8s; transform-style: preserve-3d; cursor: pointer; }
    .flipped { transform: rotateY(180deg); }
    canvas { width: 100%; height: 100%; position: absolute; backface-visibility: hidden; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.6); }
    #backCanvas { transform: rotateY(180deg); }
    #download { margin-top: 20px; }
  </style>
</head>
<body>
  <h1>Stork Community ID Badge Generator</h1>
  <form id="badgeForm">
    <label>X Handle:</label>
    <input type="text" id="xHandle" placeholder="@YourHandle" required>
    <label>A.k.a (Nickname):</label>
    <input type="text" id="nickname" placeholder="Your Nickname">
    <label>Discord Role:</label>
    <input type="text" id="discordRole" placeholder="Your Role" required>
    <label>Profile Picture (Upload or URL):</label>
    <input type="file" id="pfpFile" accept="image/*">
    <input type="text" id="pfpUrl" placeholder="Or enter image URL">
    <button type="submit">Generate Badge</button>
  </form>

  <div id="badgeContainer">
    <div class="badge" id="badge">
      <canvas id="frontCanvas" width="320" height="400"></canvas>
      <canvas id="backCanvas" width="320" height="400"></canvas>
    </div>
  </div>

  <div id="download"></div>

  <script>
    const form = document.getElementById('badgeForm');
    const badge = document.getElementById('badge');
    const frontCanvas = document.getElementById('frontCanvas');
    const backCanvas = document.getElementById('backCanvas');
    const ctxFront = frontCanvas.getContext('2d');
    const ctxBack = backCanvas.getContext('2d');

    function loadImage(src) {
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.crossOrigin = "Anonymous";
        img.src = src;
        img.onload = () => resolve(img);
        img.onerror = reject;
      });
    }

    badge.addEventListener('click', () => badge.classList.toggle('flipped'));

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const xHandle = document.getElementById('xHandle').value;
      const nickname = document.getElementById('nickname').value;
      const discordRole = document.getElementById('discordRole').value;
      let pfpSrc = document.getElementById('pfpUrl').value;

      const pfpFile = document.getElementById('pfpFile').files[0];
      if (pfpFile) {
        pfpSrc = await new Promise(resolve => {
          const reader = new FileReader();
          reader.onload = (e) => resolve(e.target.result);
          reader.readAsDataURL(pfpFile);
        });
      }

      let pfpImage = null;
      if (pfpSrc) {
        try {
          pfpImage = await loadImage(pfpSrc);
        } catch (err) {
          alert("Could not load profile picture.");
        }
      }

      drawFront(xHandle, nickname, discordRole, pfpImage);
      drawBack(xHandle, nickname, discordRole);

      const downloadDiv = document.getElementById('download');
      downloadDiv.innerHTML = "";
      const link = document.createElement('a');
      link.textContent = "Download Badge";
      link.href = frontCanvas.toDataURL("image/png");
      link.addEventListener("click", () => {
        const combined = document.createElement('canvas');
        combined.width = 320;
        combined.height = 800;
        const cctx = combined.getContext('2d');
        cctx.drawImage(frontCanvas, 0, 0);
        cctx.drawImage(backCanvas, 0, 400);
        link.href = combined.toDataURL("image/png");
        link.download = "stork-badge.png";
      });
      downloadDiv.appendChild(link);
    });

    function drawSlotAndRope(ctx) {
      // Rope (neutral gray)
      ctx.strokeStyle = "#cccccc";
      ctx.lineWidth = 6;
      ctx.beginPath();
      ctx.moveTo(120, 0);
      ctx.quadraticCurveTo(140, -40, 160, 0);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(200, 0);
      ctx.quadraticCurveTo(180, -40, 160, 0);
      ctx.stroke();

      // Slot
      ctx.fillStyle = "#E0F9FF";
      ctx.strokeStyle = "#001F3F";
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.roundRect(140, 5, 40, 12, 6);
      ctx.fill();
      ctx.stroke();
    }

    function drawFront(handle, nickname, role, pfpImage) {
      ctxFront.clearRect(0, 0, frontCanvas.width, frontCanvas.height);
      ctxFront.fillStyle = "#001F3F";
      ctxFront.fillRect(0, 0, 320, 400);

      // Bold abstract shapes
      const grad = ctxFront.createLinearGradient(0, 0, 320, 400);
      grad.addColorStop(0, "rgba(165,248,255,0.15)");
      grad.addColorStop(1, "rgba(0,31,63,0.4)");
      ctxFront.fillStyle = grad;
      ctxFront.beginPath();
      ctxFront.moveTo(0, 100);
      ctxFront.lineTo(320, 0);
      ctxFront.lineTo(320, 200);
      ctxFront.closePath();
      ctxFront.fill();

      // Rope + slot
      drawSlotAndRope(ctxFront);

      // X Handle
      ctxFront.fillStyle = "#A5F8FF";
      ctxFront.font = "bold 20px Arial";
      ctxFront.fillText(handle.replace("@",""), 20, 60);

      // Nickname
      ctxFront.fillStyle = "#FFFFFF";
      ctxFront.font = "16px Arial";
      ctxFront.fillText("A.k.a " + nickname, 20, 85);

      // Discord Role
      ctxFront.font = "italic 16px Arial";
      ctxFront.fillText(role, 20, 110);

      // Profile Picture
      if (pfpImage) {
        ctxFront.save();
        ctxFront.beginPath();
        ctxFront.arc(160, 220, 60, 0, Math.PI * 2);
        ctxFront.closePath();
        ctxFront.clip();
        ctxFront.drawImage(pfpImage, 100, 160, 120, 120);
        ctxFront.restore();

        // Glow ring
        ctxFront.strokeStyle = "#A5F8FF";
        ctxFront.lineWidth = 6;
        ctxFront.beginPath();
        ctxFront.arc(160, 220, 62, 0, Math.PI * 2);
        ctxFront.stroke();
      }

      // Branding (logo placeholder text)
      ctxFront.fillStyle = "#FFFFFF";
      ctxFront.font = "bold 18px Arial";
      ctxFront.fillText("Stork", 250, 380);
    }

    function drawBack(handle, nickname, role) {
      ctxBack.clearRect(0, 0, backCanvas.width, backCanvas.height);
      ctxBack.fillStyle = "#001F3F";
      ctxBack.fillRect(0, 0, 320, 400);

      // Bold diagonal stripe
      ctxBack.fillStyle = "rgba(165,248,255,0.2)";
      ctxBack.beginPath();
      ctxBack.moveTo(0, 250);
      ctxBack.lineTo(320, 150);
      ctxBack.lineTo(320, 400);
      ctxBack.lineTo(0, 400);
      ctxBack.closePath();
      ctxBack.fill();

      // Rope + slot
      drawSlotAndRope(ctxBack);

      // X Handle
      ctxBack.fillStyle = "#FFFFFF";
      ctxBack.font = "16px Arial";
      ctxBack.fillText(handle, 20, 60);

      // Role + A.k.a
      ctxBack.fillText(role, 20, 90);
      ctxBack.fillStyle = "#A5F8FF";
      ctxBack.fillText("A.k.a " + nickname, 20, 115);

      // Barcode (stylized lines)
      ctxBack.fillStyle = "#FFFFFF";
      for (let i = 0; i < 12; i++) {
        const barHeight = 60 + (i % 3) * 10;
        ctxBack.fillRect(40 + i * 20, 300, 8, barHeight);
      }

      // Logo watermark
      ctxBack.fillStyle = "rgba(165,248,255,0.2)";
      ctxBack.font = "bold 60px Arial";
      ctxBack.fillText("STORK", 40, 220);
    }
  </script>
</body>
</html>
